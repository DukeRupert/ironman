{{define "dashboard"}}
{{template "app-layout" .}}
{{end}}

{{define "app-content"}}
<!-- Page Header -->
<div class="md:flex md:items-center md:justify-between">
    <div class="min-w-0 flex-1">
        <h2 class="text-2xl/7 font-bold text-gray-900 sm:truncate sm:text-3xl sm:tracking-tight dark:text-white">Safety Dashboard</h2>
        <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Monitor your construction site safety inspections and compliance</p>
    </div>
    <div class="mt-4 flex md:mt-0 md:ml-4">
        <button type="button" class="inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-xs inset-ring inset-ring-gray-300 hover:bg-gray-50 dark:bg-white/10 dark:text-white dark:shadow-none dark:inset-ring-white/5 dark:hover:bg-white/20">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
            Export Report
        </button>
        <button type="button" onclick="window.location.href='/app/new-inspection'" class="ml-3 inline-flex items-center rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-xs hover:bg-indigo-700 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 dark:bg-indigo-500 dark:shadow-none dark:hover:bg-indigo-400 dark:focus-visible:outline-indigo-400">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
            </svg>
            New Inspection
        </button>
    </div>
</div>

<!-- Stats Grid -->
<div class="mt-8 grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4">
    <!-- Total Inspections -->
    <div class="overflow-hidden rounded-lg bg-white px-4 py-5 shadow-xs dark:bg-gray-800">
        <div class="flex items-center">
            <div class="flex-shrink-0">
                <div class="rounded-md bg-indigo-500 p-3">
                    <svg class="h-6 w-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v6a2 2 0 002 2h6a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
                    </svg>
                </div>
            </div>
            <div class="ml-5 w-0 flex-1">
                <dl>
                    <dt class="text-sm font-medium text-gray-500 truncate dark:text-gray-400">Total Inspections</dt>
                    <dd class="text-lg font-medium text-gray-900 dark:text-white">{{.Stats.TotalInspections}}</dd>
                </dl>
            </div>
        </div>
    </div>

    <!-- Violations Found -->
    <div class="overflow-hidden rounded-lg bg-white px-4 py-5 shadow-xs dark:bg-gray-800">
        <div class="flex items-center">
            <div class="flex-shrink-0">
                <div class="rounded-md bg-red-500 p-3">
                    <svg class="h-6 w-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.854-.833-2.464 0L3.34 16.5c-.77.833.192 2.5 1.732 2.5z" />
                    </svg>
                </div>
            </div>
            <div class="ml-5 w-0 flex-1">
                <dl>
                    <dt class="text-sm font-medium text-gray-500 truncate dark:text-gray-400">Violations Found</dt>
                    <dd class="text-lg font-medium text-gray-900 dark:text-white">{{.Stats.ViolationsFound}}</dd>
                </dl>
            </div>
        </div>
    </div>

    <!-- Compliance Rate -->
    <div class="overflow-hidden rounded-lg bg-white px-4 py-5 shadow-xs dark:bg-gray-800">
        <div class="flex items-center">
            <div class="flex-shrink-0">
                <div class="rounded-md bg-green-500 p-3">
                    <svg class="h-6 w-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </div>
            </div>
            <div class="ml-5 w-0 flex-1">
                <dl>
                    <dt class="text-sm font-medium text-gray-500 truncate dark:text-gray-400">Compliance Rate</dt>
                    <dd class="text-lg font-medium text-gray-900 dark:text-white">{{.Stats.ComplianceRate}}%</dd>
                </dl>
            </div>
        </div>
    </div>

    <!-- Active Projects -->
    <div class="overflow-hidden rounded-lg bg-white px-4 py-5 shadow-xs dark:bg-gray-800">
        <div class="flex items-center">
            <div class="flex-shrink-0">
                <div class="rounded-md bg-blue-500 p-3">
                    <svg class="h-6 w-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                    </svg>
                </div>
            </div>
            <div class="ml-5 w-0 flex-1">
                <dl>
                    <dt class="text-sm font-medium text-gray-500 truncate dark:text-gray-400">Active Projects</dt>
                    <dd class="text-lg font-medium text-gray-900 dark:text-white">{{.Stats.ActiveProjects}}</dd>
                </dl>
            </div>
        </div>
    </div>
</div>

<div class="mt-8 grid grid-cols-1 gap-8 lg:grid-cols-2">
    <!-- Recent Projects -->
    <div class="overflow-hidden rounded-lg bg-white shadow-xs dark:bg-gray-800">
        <div class="border-b border-gray-200 px-4 py-5 sm:px-6 dark:border-white/10">
            <div class="-mt-2 -ml-4 flex flex-wrap items-center justify-between sm:flex-nowrap">
                <div class="mt-2 ml-4">
                    <h3 class="text-base font-semibold text-gray-900 dark:text-white">Recent Projects</h3>
                </div>
                <div class="mt-2 ml-4 shrink-0">
                    <button type="button" onclick="window.location.href='/app/projects'" class="relative inline-flex items-center rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-xs hover:bg-indigo-500 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 dark:bg-indigo-500 dark:shadow-none dark:hover:bg-indigo-400 dark:focus-visible:outline-indigo-500">View All</button>
                </div>
            </div>
        </div>
        <div class="px-4 py-5 sm:p-6">
            {{if .RecentProjects}}
            <ul role="list" class="divide-y divide-gray-100 dark:divide-white/5">
                {{range .RecentProjects}}
                <li class="flex items-center justify-between gap-x-6 py-5">
                    <div class="min-w-0">
                        <div class="flex items-start gap-x-3">
                            <p class="text-sm/6 font-semibold text-gray-900 dark:text-white">{{.Name}}</p>
                            {{if eq .Status "completed"}}
                            <p class="mt-0.5 rounded-md bg-green-50 px-1.5 py-0.5 text-xs font-medium text-green-700 inset-ring inset-ring-green-600/20 dark:bg-green-400/10 dark:text-green-400 dark:inset-ring-green-500/20">Complete</p>
                            {{else if eq .Status "in-progress"}}
                            <p class="mt-0.5 rounded-md bg-gray-50 px-1.5 py-0.5 text-xs font-medium text-gray-600 inset-ring inset-ring-gray-500/10 dark:bg-gray-400/10 dark:text-gray-400 dark:inset-ring-gray-400/20">In Progress</p>
                            {{else if eq .Status "needs-review"}}
                            <p class="mt-0.5 rounded-md bg-yellow-50 px-1.5 py-0.5 text-xs font-medium text-yellow-800 inset-ring inset-ring-yellow-600/20 dark:bg-yellow-400/10 dark:text-yellow-500 dark:inset-ring-yellow-400/20">Needs Review</p>
                            {{end}}
                        </div>
                        <div class="mt-1 flex items-center gap-x-2 text-xs/5 text-gray-500 dark:text-gray-400">
                            <p class="whitespace-nowrap">Last updated <time datetime="{{.LastUpdated}}">{{.LastUpdatedFormatted}}</time></p>
                            <svg viewBox="0 0 2 2" class="size-0.5 fill-current">
                                <circle r="1" cx="1" cy="1" />
                            </svg>
                            <p class="truncate">{{.ViolationCount}} violations found</p>
                        </div>
                    </div>
                    <div class="flex flex-none items-center gap-x-4">
                        <a href="/app/projects/{{.ID}}" class="hidden rounded-md bg-white px-2.5 py-1.5 text-sm font-semibold text-gray-900 shadow-xs inset-ring inset-ring-gray-300 hover:bg-gray-50 sm:block dark:bg-white/10 dark:text-white dark:shadow-none dark:inset-ring-white/5 dark:hover:bg-white/20">View project<span class="sr-only">, {{.Name}}</span></a>
                        <div class="relative flex-none">
                            <button type="button" onclick="toggleProjectMenu('{{.ID}}')" class="relative block text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white">
                                <span class="absolute -inset-2.5"></span>
                                <span class="sr-only">Open options</span>
                                <svg viewBox="0 0 20 20" fill="currentColor" class="size-5">
                                    <path d="M10 3a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM10 8.5a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM11.5 15.5a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0Z" />
                                </svg>
                            </button>
                            <div id="project-menu-{{.ID}}" class="hidden absolute right-0 z-10 mt-2 w-32 origin-top-right rounded-md bg-white py-2 shadow-lg ring-1 ring-black ring-opacity-5 dark:bg-gray-800 dark:ring-white/10">
                                <a href="/app/projects/{{.ID}}/edit" class="block px-3 py-1 text-sm/6 text-gray-900 hover:bg-gray-50 dark:text-white dark:hover:bg-white/5">Edit<span class="sr-only">, {{.Name}}</span></a>
                                <a href="/app/projects/{{.ID}}/report" class="block px-3 py-1 text-sm/6 text-gray-900 hover:bg-gray-50 dark:text-white dark:hover:bg-white/5">Generate Report<span class="sr-only">, {{.Name}}</span></a>
                                <a href="/app/projects/{{.ID}}/archive" class="block px-3 py-1 text-sm/6 text-gray-900 hover:bg-gray-50 dark:text-white dark:hover:bg-white/5">Archive<span class="sr-only">, {{.Name}}</span></a>
                            </div>
                        </div>
                    </div>
                </li>
                {{end}}
            </ul>
            {{else}}
            <div class="text-center py-6">
                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                </svg>
                <h3 class="mt-2 text-sm font-medium text-gray-900 dark:text-white">No projects yet</h3>
                <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Get started by creating your first safety inspection project.</p>
                <div class="mt-6">
                    <button type="button" onclick="window.location.href='/app/new-inspection'" class="inline-flex items-center rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-xs hover:bg-indigo-500 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 dark:bg-indigo-500 dark:shadow-none dark:hover:bg-indigo-400 dark:focus-visible:outline-indigo-500">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                        </svg>
                        New Inspection
                    </button>
                </div>
            </div>
            {{end}}
        </div>
    </div>

    <!-- Critical Violations -->
    <div class="overflow-hidden rounded-lg bg-white shadow-xs dark:bg-gray-800">
        <div class="border-b border-gray-200 px-4 py-5 sm:px-6 dark:border-white/10">
            <div class="-mt-2 -ml-4 flex flex-wrap items-center justify-between sm:flex-nowrap">
                <div class="mt-2 ml-4">
                    <h3 class="text-base font-semibold text-gray-900 dark:text-white">Critical Violations</h3>
                </div>
                <div class="mt-2 ml-4 shrink-0">
                    <button type="button" onclick="window.location.href='/app/reports?filter=critical'" class="relative inline-flex items-center rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-xs hover:bg-red-500 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-600 dark:bg-red-500 dark:shadow-none dark:hover:bg-red-400 dark:focus-visible:outline-red-500">View All</button>
                </div>
            </div>
        </div>
        <div class="px-4 py-5 sm:p-6">
            {{if .CriticalViolations}}
            <ul role="list" class="divide-y divide-gray-100 dark:divide-white/5">
                {{range .CriticalViolations}}
                <li class="flex items-start gap-x-3 py-4">
                    <div class="flex-shrink-0">
                        <div class="h-2 w-2 rounded-full bg-red-400 mt-2"></div>
                    </div>
                    <div class="min-w-0 flex-1">
                        <p class="text-sm font-medium text-gray-900 dark:text-white">{{.Description}}</p>
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">OSHA {{.Regulation}} â€¢ {{.ProjectName}}</p>
                        <p class="mt-1 text-xs text-red-600 dark:text-red-400">High Risk</p>
                    </div>
                    <div class="flex-shrink-0">
                        <a href="/app/projects/{{.ProjectID}}/violations/{{.ID}}" class="text-indigo-600 hover:text-indigo-500 dark:text-indigo-400 dark:hover:text-indigo-300">
                            <span class="sr-only">View violation details</span>
                            <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd" />
                            </svg>
                        </a>
                    </div>
                </li>
                {{end}}
            </ul>
            {{else}}
            <div class="text-center py-6">
                <svg class="mx-auto h-12 w-12 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <h3 class="mt-2 text-sm font-medium text-gray-900 dark:text-white">No critical violations</h3>
                <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">Your construction sites are meeting safety standards.</p>
            </div>
            {{end}}
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="mt-8">
    <div class="border-b border-gray-200 pb-5 sm:flex sm:items-center sm:justify-between dark:border-white/10">
        <h3 class="text-base font-semibold text-gray-900 dark:text-white">Quick Actions</h3>
    </div>
    <div class="mt-6 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4">
        <button type="button" onclick="window.location.href='/app/new-inspection'" class="relative block w-full rounded-lg border-2 border-dashed border-gray-300 p-6 text-center hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:border-gray-600 dark:hover:border-gray-500">
            <svg class="mx-auto h-8 w-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
            </svg>
            <span class="mt-2 block text-sm font-medium text-gray-900 dark:text-white">Start New Inspection</span>
        </button>

        <button type="button" onclick="window.location.href='/app/projects'" class="relative block w-full rounded-lg border-2 border-dashed border-gray-300 p-6 text-center hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:border-gray-600 dark:hover:border-gray-500">
            <svg class="mx-auto h-8 w-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
            </svg>
            <span class="mt-2 block text-sm font-medium text-gray-900 dark:text-white">Browse Projects</span>
        </button>

        <button type="button" onclick="window.location.href='/app/reports'" class="relative block w-full rounded-lg border-2 border-dashed border-gray-300 p-6 text-center hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:border-gray-600 dark:hover:border-gray-500">
            <svg class="mx-auto h-8 w-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
            <span class="mt-2 block text-sm font-medium text-gray-900 dark:text-white">Generate Reports</span>
        </button>

        <button type="button" onclick="window.location.href='/app/team'" class="relative block w-full rounded-lg border-2 border-dashed border-gray-300 p-6 text-center hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:border-gray-600 dark:hover:border-gray-500">
            <svg class="mx-auto h-8 w-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
            </svg>
            <span class="mt-2 block text-sm font-medium text-gray-900 dark:text-white">Manage Team</span>
        </button>
    </div>
</div>

<script>
function toggleProjectMenu(projectId) {
    const menu = document.getElementById('project-menu-' + projectId);
    // Close all other project menus
    document.querySelectorAll('[id^="project-menu-"]').forEach(function(otherMenu) {
        if (otherMenu.id !== 'project-menu-' + projectId) {
            otherMenu.classList.add('hidden');
        }
    });
    // Toggle the current menu
    menu.classList.toggle('hidden');
}

// Close all project menus when clicking outside
document.addEventListener('click', function(event) {
    if (!event.target.closest('[onclick^="toggleProjectMenu"]') && !event.target.closest('[id^="project-menu-"]')) {
        document.querySelectorAll('[id^="project-menu-"]').forEach(function(menu) {
            menu.classList.add('hidden');
        });
    }
});
</script>
{{end}}